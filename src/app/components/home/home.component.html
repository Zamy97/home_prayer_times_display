<main class="board" aria-label="Prayer times screen">
  <!-- Hidden hot corner (top-left): press & hold to open settings -->
  <div
    class="hotCorner"
    role="button"
    tabindex="0"
    aria-label="Open settings (press and hold)"
    (pointerdown)="onHotCornerDown($event)"
    (pointerup)="onHotCornerUp($event)"
    (pointercancel)="onHotCornerUp($event)"
    (pointerleave)="onHotCornerUp($event)"
    (keydown.enter)="onHotCornerDown($event)"
    (keydown.space)="onHotCornerDown($event)"
    (keyup.enter)="onHotCornerUp($event)"
    (keyup.space)="onHotCornerUp($event)"
  ></div>

  <!-- Top-right: current temperature -->
  <div class="tempCorner" aria-label="Current temperature">
    @if (currentTempF !== null) {
      {{ currentTempF | number:'1.0-0' }}°F
    } @else {
      <span aria-hidden="true">--</span>
    }
  </div>

  @if (showGeoPrompt) {
  <div class="geoPromptBackdrop" role="dialog" aria-modal="true" aria-label="Use current location">
    <div class="geoPromptCard">
      <div class="geoPromptTitle">Use your current location?</div>
      <div class="geoPromptText">
        We’ll use it to calculate prayer times and save it on this device.
      </div>

      @if (geoStatus && geoStatus !== 'loading') {
        <div class="geoPromptError">{{ geoStatus }}</div>
      }

      <div class="geoPromptActions">
        <button
          type="button"
          class="geoPromptBtn primary"
          [disabled]="geoStatus === 'loading'"
          (click)="useMyLocation()"
        >
          {{ geoStatus === 'loading' ? 'Getting location…' : 'Use my location' }}
        </button>
        <button type="button" class="geoPromptBtn" (click)="dismissGeoPrompt()">Not now</button>
      </div>

      <div class="geoPromptSmall">
        You can also set latitude/longitude in <a routerLink="/settings">Settings</a>.
      </div>
    </div>
  </div>
  }

  <section class="content" [class.panel-left]="panelLeft">
    <div class="grid" aria-label="Prayer times grid">
      <!-- Row 1 (FAJR) -->
      <div class="cell dark prayer" [class.is-next]="nextPrayerKey === 'fajr'">FAJR</div>
      <div class="cell dark" [class.is-next]="nextPrayerKey === 'fajr'">
        <div class="timeStack">
          <div class="colLabel">STARTS</div>
          <div class="time">
            {{ times?.fajr?.time ?? '-----' }}<span class="ampm">{{ times?.fajr?.ampm }}</span>
          </div>
        </div>
      </div>

      <!-- Row 2 (DHUHR) -->
      <div class="cell dark prayer" [class.is-next]="nextPrayerKey === 'dhuhr'">DHUHR</div>
      <div class="cell dark" [class.is-next]="nextPrayerKey === 'dhuhr'">
        <div class="time">
          {{ times?.dhuhr?.time ?? '-----' }}<span class="ampm">{{ times?.dhuhr?.ampm }}</span>
        </div>
      </div>

      <!-- Row 3 (ASR) -->
      <div class="cell dark prayer" [class.is-next]="nextPrayerKey === 'asr'">ASR</div>
      <div class="cell dark" [class.is-next]="nextPrayerKey === 'asr'">
        <div class="time">
          {{ times?.asr?.time ?? '-----' }}<span class="ampm">{{ times?.asr?.ampm }}</span>
        </div>
      </div>

      <!-- Row 4 (MAGHRIB) -->
      <div class="cell dark prayer" [class.is-next]="nextPrayerKey === 'maghrib'">MAGHRIB</div>
      <div class="cell dark" [class.is-next]="nextPrayerKey === 'maghrib'">
        <div class="time">
          {{ times?.maghrib?.time ?? '-----' }}
          <span class="ampm">{{ times?.maghrib?.ampm }}</span>
        </div>
      </div>

      <!-- Row 5 (ISHA) -->
      <div
        class="cell dark prayer row-last"
        [class.is-next]="nextPrayerKey === 'isha'"
      >
        ISHA
      </div>
      <div class="cell dark row-last" [class.is-next]="nextPrayerKey === 'isha'">
        <div class="time">
          {{ times?.isha?.time ?? '-----' }}<span class="ampm">{{ times?.isha?.ampm }}</span>
        </div>
      </div>
    </div>

    <!-- Right panel (current time + date) -->
    <aside class="panel" aria-label="Date panel">
      <header class="panelTop">
        <div class="dateRow">
          <span class="hijri">{{ hijriDateLabel || '-----' }}</span>
          <span class="greg">{{ gregDateLabel || '-----' }}</span>
        </div>
      </header>
      <div class="rule" aria-hidden="true"></div>

      <div class="panelMid">
        <div class="clockBlock" [class.clock-two-digits]="isTwoDigitHour">
          <div class="now" aria-label="Current time">
            <span class="nowMain">{{ nowTime }}</span>
            <span class="nowSide" aria-label="Seconds and meridiem">
              <span class="seconds">:{{ nowSeconds }}</span>
              <span class="ampm">{{ nowAmPm }}</span>
            </span>
          </div>
          <div class="countdown">
            NEXT <span class="countdownPrayer">{{ nextPrayerLabel }}</span> IN
            <span class="countdownTime">{{ nextPrayerCountdown || '--:--:--' }}</span>
          </div>
        </div>

        <div class="jumuBlock">
          <div class="rule" aria-hidden="true" style="margin: 14px 0 16px 0"></div>

          <div class="jum">
            <p class="jumTitle">JUMU'AH</p>
            <div class="jumGrid">
              <div>
                <p class="jumTime">1:00<span class="ampm">PM</span></p>
                <p class="jumLabel">STARTS</p>
              </div>
              <div>
                <p class="jumTime">1:30<span class="ampm">PM</span></p>
                <p class="jumLabel">JUMU'AH</p>
              </div>
            </div>
          </div>
        </div>

        @if (!times?.raw && !showGeoPrompt) {
        <div class="locationNeeded">
          <div class="locationNeededTitle">Location needed</div>
          @if (geoStatus === 'loading') {
            <div class="locationNeededHint">Getting location…</div>
          } @else if (geoStatus) {
            <div class="locationError">{{ geoStatus }}</div>
          } @else {
            <button type="button" class="locationBtn" (click)="useMyLocation()">Use my location</button>
            <div class="locationNeededHint">
              Or set latitude/longitude in <a routerLink="/settings">Settings</a>
            </div>
          }
        </div>
        }
      </div>

      <div class="sunBar" aria-label="Sunrise and sunset">
        <div class="sunRow">
          <svg
            class="icon"
            viewBox="0 0 64 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              d="M8 26C14 16 22 10 32 10C42 10 50 16 56 26"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path d="M32 6V1" stroke="white" stroke-width="3" stroke-linecap="round" />
            <path
              d="M20 10L16 6"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M44 10L48 6"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M8 30H56"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
              opacity="0.85"
            />
          </svg>
          <span>SUNRISE</span>
          <span class="sunTime"
            >{{ sunrise?.time ?? '-----' }}<span class="ampm">{{ sunrise?.ampm }}</span></span
          >
        </div>
        <div class="sunRow">
          <svg
            class="icon"
            viewBox="0 0 64 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              d="M8 22C14 32 22 36 32 36C42 36 50 32 56 22"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M32 30V35"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M20 26L16 30"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M44 26L48 30"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
            />
            <path
              d="M8 16H56"
              stroke="white"
              stroke-width="3"
              stroke-linecap="round"
              opacity="0.85"
            />
          </svg>
          <span>SUNSET</span>
          <span class="sunTime"
            >{{ sunset?.time ?? '-----' }}<span class="ampm">{{ sunset?.ampm }}</span></span
          >
        </div>
      </div>
    </aside>
  </section>
</main>

